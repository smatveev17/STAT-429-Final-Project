knitr::opts_chunk$set(echo = TRUE)
library(WaveletComp)
df <- data.frame(time = time(data_ts), value = as.numeric(data_ts))
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(astsa)
data <-read_delim("SN_y_tot_V2.0.csv",
delim = ";", escape_double = FALSE, col_names = FALSE,
trim_ws = TRUE, show_col_types = FALSE)
names(data) = c("Year", "Mean Sunspots", "Mean SD", "Observations", "Marker")
data
data_ts <- data|>
select(c(2))
data_ts <- ts(data_ts, start = 1700.5)
tsplot(data_ts)
x <- data_ts - mean(data_ts)
s_un <- spec.pgram(x, log = "no")
s_sm <- spec.pgram(x, spans = c(5,5), log = "no",
main="Smoothed Spectral Density")
spec <- spec.pgram(x, plot=FALSE)
freq_max <- spec$freq[which.max(spec$spec)]
period_est <- 1 / freq_max
period_est
ar_fit <- ar(x, method = "yw")
ar_fit$order
s_ar <- spec.ar(x, main="AR Spectral Density Estimate")
library(WaveletComp)
df <- data.frame(time = time(data_ts), value = as.numeric(data_ts))
result <- analyze.wavelet(
df,
"value",
loess.span = 0,
dt = 1,
dj = 1/20,
lowerPeriod = 2,
upperPeriod = 256,
make.pval = FALSE
)
wt.image(result,
color.key = "quantile",
legend.params = list(lab = "Power"),
main = "Wavelet-Based Evolutive Harmonic Analysis")
install.packages("multitaper")
library(multitaper)
spec.mtm(data_ts)
library(multitaper)
ev <- mtfe(data_ts, nw = 4, k = 7)
library(tidyverse)
library(astsa)
library(multitaper)
ev <- mtfe(data_ts, nw = 4, k = 7)
library(Rssa)
install.packages("Rssa")
library(Rssa)
s <- ssa(data_ts, L=50)
library(multitaper)
x <- data_ts - mean(data_ts)
window_length <- 70
step <- 10
N <- length(x)
spec_list <- list()
times <- seq(1, N - window_length, by = step)
for (i in times) {
segment <- x[i:(i + window_length - 1)]
spec <- spec.mtm(segment, nw = 4, k = 7, plot = FALSE)
spec_list[[length(spec_list) + 1]] <- list(
freq = spec$freq,
spec = spec$spec
)
}
library(multitaper)
x <- data_ts - mean(data_ts)
window_length <- 70
step <- 10
N <- length(x)
spec_list <- list()
times <- seq(1, N - window_length, by = step)
for (i in times) {
segment <- x[i:(i + window_length - 1)]
spec <- spec.mtm(segment, nw = 4, k = 7, plot = FALSE)
spec_list[[length(spec_list) + 1]] <- list(
freq = spec$freq,
spec = spec$spec
)
}
freq_matrix <- do.call(cbind, lapply(spec_list, function(z) z$spec))
persp(
x = spec_list[[1]]$freq,
y = times,
z = freq_matrix,
theta = 35, phi = 30,
xlab="Frequency (cycles/year)",
ylab="Start Year",
zlab="Spectral Density"
)
persp(
x = spec_list[[1]]$freq,
y = times,
z = freq_matrix,
theta = 90, phi = 30,
xlab="Frequency (cycles/year)",
ylab="Start Year",
zlab="Spectral Density"
)
freq_matrix <- do.call(cbind, lapply(spec_list, function(z) z$spec))
persp(
x = spec_list[[1]]$freq,
y = times,
z = freq_matrix,
theta = 90, phi = 30,
xlab="Frequency (cycles/year)",
ylab="Start Year",
zlab="Spectral Density"
)
persp(
x = spec_list[[1]]$freq,
y = times,
z = freq_matrix,
theta = 180, phi = 30,
xlab="Frequency (cycles/year)",
ylab="Start Year",
zlab="Spectral Density"
)
freq_matrix <- do.call(cbind, lapply(spec_list, function(z) z$spec))
persp(
x = spec_list[[1]]$freq,
y = times,
z = freq_matrix,
theta = 115, phi = 30,
xlab="Frequency (cycles/year)",
ylab="Start Year",
zlab="Spectral Density"
)
library(multitaper)
x <- data_ts - mean(data_ts)
window_length <- 70
step <- 10
N <- length(x)
spec_list <- list()
times <- seq(1, N - window_length, by = step)
for (i in times) {
segment <- x[i:(i + window_length - 1)]
spec <- spec.mtm(segment, nw = 4, k = 7, plot = FALSE)
spec_list[[length(spec_list) + 1]] <- list(
freq = spec$freq,
spec = spec$spec
)
}
freq_matrix <- do.call(cbind, lapply(spec_list, function(z) z$spec))
persp(
x = spec_list[[1]]$freq,
y = times,
z = freq_matrix,
theta = 115, phi = 30,
xlab="Frequency (cycles/year)",
ylab="Start Year",
zlab="Spectral Density"
)
freq_matrix <- do.call(cbind, lapply(spec_list, function(z) z$spec))
persp(
x = spec_list[[1]]$freq,
y = times,
z = freq_matrix,
theta = 100, phi = 30,
xlab="Frequency (cycles/year)",
ylab="Start Year",
zlab="Spectral Density"
)
freq_matrix <- do.call(cbind, lapply(spec_list, function(z) z$spec))
persp(
x = spec_list[[1]]$freq,
y = times,
z = freq_matrix,
theta = 120, phi = 30,
xlab="Frequency (cycles/year)",
ylab="Start Year",
zlab="Spectral Density"
)
freq_matrix <- do.call(cbind, lapply(spec_list, function(z) z$spec))
persp(
x = spec_list[[1]]$freq,
y = times,
z = freq_matrix,
theta = 35, phi = 30,
xlab="Frequency (cycles/year)",
ylab="Start Year",
zlab="Spectral Density"
)
install.packages("astrochron")
library(astrochron)
mesa_result <- mem(x, npoles=20, plot=TRUE)
demo <- cmfilter(x, 11)   # demodulate around 11-year frequency
x <- as.numeric(data_ts)
T0 <- period_est
f0 <- 1 / T0
t <- 1:length(x)
z <- x * exp(-1i * 2 * pi * f0 * t)
library(stats)
k <- 25
z_smooth <- filter(z, rep(1/k, k), sides = 2)
library(stats)
k <- 25
z_smooth <- filter(z, rep(1/k, k), sides = 2)
library(signal)
install.packages("signal")
library(signal)
bf <- butter(4, 0.05)
z_smooth <- filtfilt(bf, z)
library(signal)
bf <- butter(4, 0.05)
z_smooth <- filtfilt(bf, z)
amp <- Mod(z_smooth)
phase <- Arg(z_smooth)
amp <- Mod(z_smooth)
phase <- Arg(z_smooth)
plot(amp, type="l", main="Instantaneous Amplitude")
plot(amp, type="l", main="Instantaneous Amplitude")
plot(phase, type="l", main="Instantaneous Amplitude")
plot(phase, type="l", main="Instantaneous Amplitude")
plot(phase, type="l", main="Instantaneous Phase")
inst_freq <- c(NA, diff(phase)) / (2*pi)
inst_period <- 1 / inst_freq
inst_freq <- c(NA, diff(phase)) / (2*pi)
inst_period <- 1 / inst_freq
plot(inst_period, type="l",
main="Instantaneous Period of Sunspot Cycle",
ylab="Years")
abline(h=11, col="red")
inst_freq <- c(NA, diff(phase)) / (2*pi)
inst_period <- 1 / inst_freq
plot(inst_period, type="l",
main="Instantaneous Period of Sunspot Cycle",
ylab="Years")
abline(h=11, col="red")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(astsa)
data <-read_delim("SN_y_tot_V2.0.csv",
delim = ";", escape_double = FALSE, col_names = FALSE,
trim_ws = TRUE, show_col_types = FALSE)
names(data) = c("Year", "Mean Sunspots", "Mean SD", "Observations", "Marker")
data
data_ts <- data|>
select(c(2))
data_ts <- ts(data_ts, start = 1700.5)
tsplot(data_ts)
x <- data_ts - mean(data_ts)
s_un <- spec.pgram(x, log = "no")
s_sm <- spec.pgram(x, spans = c(5,5), log = "no",
main="Smoothed Spectral Density")
spec <- spec.pgram(x, plot=FALSE)
freq_max <- spec$freq[which.max(spec$spec)]
period_est <- 1 / freq_max
period_est
ar_fit <- ar(x, method = "yw")
ar_fit$order
s_ar <- spec.ar(x, main="AR Spectral Density Estimate")
library(WaveletComp)
df <- data.frame(time = time(data_ts), value = as.numeric(data_ts))
result <- analyze.wavelet(
df,
"value",
loess.span = 0,
dt = 1,
dj = 1/20,
lowerPeriod = 2,
upperPeriod = 256,
make.pval = FALSE
)
wt.image(result,
color.key = "quantile",
legend.params = list(lab = "Power"),
main = "Wavelet-Based Evolutive Harmonic Analysis")
library(multitaper)
x <- data_ts - mean(data_ts)
window_length <- 70
step <- 10
N <- length(x)
spec_list <- list()
times <- seq(1, N - window_length, by = step)
for (i in times) {
segment <- x[i:(i + window_length - 1)]
spec <- spec.mtm(segment, nw = 4, k = 7, plot = FALSE)
spec_list[[length(spec_list) + 1]] <- list(
freq = spec$freq,
spec = spec$spec
)
}
freq_matrix <- do.call(cbind, lapply(spec_list, function(z) z$spec))
persp(
x = spec_list[[1]]$freq,
y = times,
z = freq_matrix,
theta = 35, phi = 30,
xlab="Frequency (cycles/year)",
ylab="Start Year",
zlab="Spectral Density"
)
x <- as.numeric(data_ts)
T0 <- period_est
f0 <- 1 / T0
t <- 1:length(x)
z <- x * exp(-1i * 2 * pi * f0 * t)
library(signal)
bf <- butter(4, 0.05)
z_smooth <- filtfilt(bf, z)
amp <- Mod(z_smooth)
phase <- Arg(z_smooth)
plot(amp, type="l", main="Instantaneous Amplitude")
plot(phase, type="l", main="Instantaneous Phase")
inst_freq <- c(NA, diff(phase)) / (2*pi)
inst_period <- 1 / inst_freq
plot(inst_period, type="l",
main="Instantaneous Period of Sunspot Cycle",
ylab="Years")
abline(h=11, col="red")
inst_freq
c(NA, diff(phase))
inst_freq
c(NA, diff(phase))
inst_period
bf2 <- butter(3, 0.02)
smooth_phase <- filtfilt(bf2, phase)
inst_freq <- c(NA, diff(smooth_phase)) / (2*pi)
inst_period <- 1 / inst_freq
plot(inst_period, type="l",
main="Instantaneous Period of Sunspot Cycle",
ylab="Years")
abline(h=11, col="red")
library(signal)
bf <- butter(4, 0.02)
z_lp <- filtfilt(bf, z)
library(signal)
bf <- butter(4, 0.02)
z_lp <- filtfilt(bf, z)
phi <- Arg(z_lp)
phi_unwrapped <- pracma::unwrap(phi)
library(signal)
library(pracma)
bf <- butter(4, 0.02)
z_lp <- filtfilt(bf, z)
phi <- Arg(z_lp)
phi_unwrapped <- unwrap(phi)
library(signal)
library(pracma)
bf <- butter(4, 0.02)
z_lp <- filtfilt(bf, z)
phi <- Arg(z_lp)
phi_unwrapped <- unwrap(phi)
phi_smooth <- filtfilt(butter(3, 0.01), phi_unwrapped)
phi_smooth <- filtfilt(butter(3, 0.01), phi_unwrapped)
dphi <- c(NA, diff(phi_smooth))
inst_freq <- dphi / (2*pi)
inst_freq
phi_smooth <- filtfilt(butter(3, 0.01), phi_unwrapped)
dphi <- c(NA, diff(phi_smooth))
inst_freq <- dphi / (2*pi)
inst_freq[abs(inst_freq) < 0.0005] <- NA
inst_freq
phi_smooth <- filtfilt(butter(3, 0.01), phi_unwrapped)
dphi <- c(NA, diff(phi_smooth))
inst_freq <- dphi / (2*pi)
inst_freq[abs(inst_freq) < 0.0005] <- NA
inst_period <- 1 / inst_freq
plot(inst_period, type="l",
main="Instantaneous Period of Sunspot Cycle",
ylab="Years")
abline(h=11, col="red")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(astsa)
data <-read_delim("SN_y_tot_V2.0.csv",
delim = ";", escape_double = FALSE, col_names = FALSE,
trim_ws = TRUE, show_col_types = FALSE)
names(data) = c("Year", "Mean Sunspots", "Mean SD", "Observations", "Marker")
data
data_ts <- data|>
select(c(2))
data_ts <- ts(data_ts, start = 1700.5)
tsplot(data_ts)
x <- data_ts - mean(data_ts)
s_un <- spec.pgram(x, log = "no")
s_sm <- spec.pgram(x, spans = c(5,5), log = "no",
main="Smoothed Spectral Density")
spec <- spec.pgram(x, plot=FALSE)
freq_max <- spec$freq[which.max(spec$spec)]
period_est <- 1 / freq_max
period_est
ar_fit <- ar(x, method = "yw")
ar_fit$order
s_ar <- spec.ar(x, main="AR Spectral Density Estimate")
library(WaveletComp)
df <- data.frame(time = time(data_ts), value = as.numeric(data_ts))
result <- analyze.wavelet(
df,
"value",
loess.span = 0,
dt = 1,
dj = 1/20,
lowerPeriod = 2,
upperPeriod = 256,
make.pval = FALSE
)
wt.image(result,
color.key = "quantile",
legend.params = list(lab = "Power"),
main = "Wavelet-Based Evolutive Harmonic Analysis")
library(multitaper)
x <- data_ts - mean(data_ts)
window_length <- 70
step <- 10
N <- length(x)
spec_list <- list()
times <- seq(1, N - window_length, by = step)
for (i in times) {
segment <- x[i:(i + window_length - 1)]
spec <- spec.mtm(segment, nw = 4, k = 7, plot = FALSE)
spec_list[[length(spec_list) + 1]] <- list(
freq = spec$freq,
spec = spec$spec
)
}
freq_matrix <- do.call(cbind, lapply(spec_list, function(z) z$spec))
persp(
x = spec_list[[1]]$freq,
y = times,
z = freq_matrix,
theta = 35, phi = 30,
xlab="Frequency (cycles/year)",
ylab="Start Year",
zlab="Spectral Density"
)
x <- as.numeric(data_ts)
t <- 1:length(x)
f0 <- 1/22
z <- x * exp(-1i * 2*pi*f0*t)
library(signal)
library(pracma)
bf <- butter(4, 0.02)
z_lp <- filtfilt(bf, z)
phi <- Arg(z_lp)
phi_unwrapped <- unwrap(phi)
phi_smooth <- filtfilt(butter(3, 0.01), phi_unwrapped)
dphi <- c(NA, diff(phi_smooth))
inst_freq <- dphi / (2*pi)
inst_freq[abs(inst_freq) < 0.0005] <- NA
inst_period <- 1 / inst_freq
plot(inst_period, type="l",
main="Instantaneous Period of Sunspot Cycle",
ylab="Years")
abline(h=11, col="red")
plot(inst_period, type="l",
main="Instantaneous Period of Sunspot Cycle",
ylab="Years")
abline(h=22, col="red")
library(signal)
library(pracma)
x <- as.numeric(data_ts)
t <- 1:length(x)
# Demodulation at 22-year cycle
f0 <- 1/22
z <- x * exp(-1i * 2*pi*f0*t)
# -------- LOW-PASS FILTER (CRITICAL) --------
# Butterworth filter: cutoff chosen to keep slow variations only
bf <- butter(4, 0.05)     # try 0.02â€“0.07 for experimenting
z_lp <- filtfilt(bf, z)
# Extract amplitude and phase
amp <- Mod(z_lp)
phi <- Arg(z_lp)
# -------- PHASE UNWRAPPING AND SMOOTHING --------
phi_unwrapped <- unwrap(phi)
# Smooth the unwrapped phase
bf2 <- butter(3, 0.01)
phi_smooth <- filtfilt(bf2, phi_unwrapped)
# Instantaneous angular frequency
dphi <- c(NA, diff(phi_smooth))
# Instantaneous frequency
inst_freq <- dphi / (2*pi)
# Remove unstable values
inst_freq[abs(inst_freq) < 1e-5] <- NA
# Instantaneous period
inst_period <- 1 / inst_freq
# Plotting
plot(inst_period, type="l",
main="Instantaneous Period (22-Year Cycle)",
ylab="Years")
abline(h=22, col="red")
