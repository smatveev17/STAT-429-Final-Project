abline(h=11, col="red")
inst_freq
c(NA, diff(phase))
inst_freq
c(NA, diff(phase))
inst_period
bf2 <- butter(3, 0.02)
smooth_phase <- filtfilt(bf2, phase)
inst_freq <- c(NA, diff(smooth_phase)) / (2*pi)
inst_period <- 1 / inst_freq
plot(inst_period, type="l",
main="Instantaneous Period of Sunspot Cycle",
ylab="Years")
abline(h=11, col="red")
library(signal)
bf <- butter(4, 0.02)
z_lp <- filtfilt(bf, z)
library(signal)
bf <- butter(4, 0.02)
z_lp <- filtfilt(bf, z)
phi <- Arg(z_lp)
phi_unwrapped <- pracma::unwrap(phi)
library(signal)
library(pracma)
bf <- butter(4, 0.02)
z_lp <- filtfilt(bf, z)
phi <- Arg(z_lp)
phi_unwrapped <- unwrap(phi)
library(signal)
library(pracma)
bf <- butter(4, 0.02)
z_lp <- filtfilt(bf, z)
phi <- Arg(z_lp)
phi_unwrapped <- unwrap(phi)
phi_smooth <- filtfilt(butter(3, 0.01), phi_unwrapped)
phi_smooth <- filtfilt(butter(3, 0.01), phi_unwrapped)
dphi <- c(NA, diff(phi_smooth))
inst_freq <- dphi / (2*pi)
inst_freq
phi_smooth <- filtfilt(butter(3, 0.01), phi_unwrapped)
dphi <- c(NA, diff(phi_smooth))
inst_freq <- dphi / (2*pi)
inst_freq[abs(inst_freq) < 0.0005] <- NA
inst_freq
phi_smooth <- filtfilt(butter(3, 0.01), phi_unwrapped)
dphi <- c(NA, diff(phi_smooth))
inst_freq <- dphi / (2*pi)
inst_freq[abs(inst_freq) < 0.0005] <- NA
inst_period <- 1 / inst_freq
plot(inst_period, type="l",
main="Instantaneous Period of Sunspot Cycle",
ylab="Years")
abline(h=11, col="red")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(astsa)
data <-read_delim("SN_y_tot_V2.0.csv",
delim = ";", escape_double = FALSE, col_names = FALSE,
trim_ws = TRUE, show_col_types = FALSE)
names(data) = c("Year", "Mean Sunspots", "Mean SD", "Observations", "Marker")
data
data_ts <- data|>
select(c(2))
data_ts <- ts(data_ts, start = 1700.5)
tsplot(data_ts)
x <- data_ts - mean(data_ts)
s_un <- spec.pgram(x, log = "no")
s_sm <- spec.pgram(x, spans = c(5,5), log = "no",
main="Smoothed Spectral Density")
spec <- spec.pgram(x, plot=FALSE)
freq_max <- spec$freq[which.max(spec$spec)]
period_est <- 1 / freq_max
period_est
ar_fit <- ar(x, method = "yw")
ar_fit$order
s_ar <- spec.ar(x, main="AR Spectral Density Estimate")
library(WaveletComp)
df <- data.frame(time = time(data_ts), value = as.numeric(data_ts))
result <- analyze.wavelet(
df,
"value",
loess.span = 0,
dt = 1,
dj = 1/20,
lowerPeriod = 2,
upperPeriod = 256,
make.pval = FALSE
)
wt.image(result,
color.key = "quantile",
legend.params = list(lab = "Power"),
main = "Wavelet-Based Evolutive Harmonic Analysis")
library(multitaper)
x <- data_ts - mean(data_ts)
window_length <- 70
step <- 10
N <- length(x)
spec_list <- list()
times <- seq(1, N - window_length, by = step)
for (i in times) {
segment <- x[i:(i + window_length - 1)]
spec <- spec.mtm(segment, nw = 4, k = 7, plot = FALSE)
spec_list[[length(spec_list) + 1]] <- list(
freq = spec$freq,
spec = spec$spec
)
}
freq_matrix <- do.call(cbind, lapply(spec_list, function(z) z$spec))
persp(
x = spec_list[[1]]$freq,
y = times,
z = freq_matrix,
theta = 35, phi = 30,
xlab="Frequency (cycles/year)",
ylab="Start Year",
zlab="Spectral Density"
)
x <- as.numeric(data_ts)
t <- 1:length(x)
f0 <- 1/22
z <- x * exp(-1i * 2*pi*f0*t)
library(signal)
library(pracma)
bf <- butter(4, 0.02)
z_lp <- filtfilt(bf, z)
phi <- Arg(z_lp)
phi_unwrapped <- unwrap(phi)
phi_smooth <- filtfilt(butter(3, 0.01), phi_unwrapped)
dphi <- c(NA, diff(phi_smooth))
inst_freq <- dphi / (2*pi)
inst_freq[abs(inst_freq) < 0.0005] <- NA
inst_period <- 1 / inst_freq
plot(inst_period, type="l",
main="Instantaneous Period of Sunspot Cycle",
ylab="Years")
abline(h=11, col="red")
plot(inst_period, type="l",
main="Instantaneous Period of Sunspot Cycle",
ylab="Years")
abline(h=22, col="red")
library(signal)
library(pracma)
x <- as.numeric(data_ts)
t <- 1:length(x)
# Demodulation at 22-year cycle
f0 <- 1/22
z <- x * exp(-1i * 2*pi*f0*t)
# -------- LOW-PASS FILTER (CRITICAL) --------
# Butterworth filter: cutoff chosen to keep slow variations only
bf <- butter(4, 0.05)     # try 0.02â€“0.07 for experimenting
z_lp <- filtfilt(bf, z)
# Extract amplitude and phase
amp <- Mod(z_lp)
phi <- Arg(z_lp)
# -------- PHASE UNWRAPPING AND SMOOTHING --------
phi_unwrapped <- unwrap(phi)
# Smooth the unwrapped phase
bf2 <- butter(3, 0.01)
phi_smooth <- filtfilt(bf2, phi_unwrapped)
# Instantaneous angular frequency
dphi <- c(NA, diff(phi_smooth))
# Instantaneous frequency
inst_freq <- dphi / (2*pi)
# Remove unstable values
inst_freq[abs(inst_freq) < 1e-5] <- NA
# Instantaneous period
inst_period <- 1 / inst_freq
# Plotting
plot(inst_period, type="l",
main="Instantaneous Period (22-Year Cycle)",
ylab="Years")
abline(h=22, col="red")
knitr::opts_chunk$set(echo = FALSE)
co2 <- read_csv("data/Data.csv", show_col_types = FALSE)
library(dplyr)
library(tidyverse)
library(astsa)
library(TSA)
library(fpp2)
library(nlme)
library(forecast)
library(tseries)
library(zoo)
library(car)
co2 <- read_csv("data/Data.csv", show_col_types = FALSE)
temp <- read_csv("data/Temperature.csv", show_col_types = FALSE)
co2 <- co2 %>%
filter(Name == "United States" & year >= 1900 & year <= 2022)
df <- co2 %>%
left_join(temp, by = c("year" = "Year"))
head(df)
summary(df)
df %>%
select(year, population, gdp, co2, nitrous_oxide, methane, Average_Fahrenheit_Temperature) %>%
summarise(across(everything(), ~sum(is.na(.))))
df %>%
select(year, population, gdp, co2, nitrous_oxide, methane, Average_Fahrenheit_Temperature) %>%
summarise(across(everything(), ~sum(is.na(.))))
knitr::opts_chunk$set(echo = TRUE)
df %>%
select(year, population, gdp, co2, nitrous_oxide, methane, Average_Fahrenheit_Temperature) %>%
summarise(across(everything(), ~sum(is.na(.))))
# Time series plot of temperature
temp_ts <- ts(df$Average_Fahrenheit_Temperature, start = 1900, frequency = 1)
tsplot(temp_ts, ylab = "Average Temperature (F)", main = "Average Annual US Temperature 1900-2022")
tsplot(temp_ts, ylab = "Average Temperature (F)", main = "Average Annual US Temperature 1900-2022")
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyverse)
library(astsa)
library(TSA)
library(fpp2)
library(nlme)
library(forecast)
library(tseries)
library(zoo)
library(car)
co2 <- read_csv("data/Data.csv", show_col_types = FALSE)
temp <- read_csv("data/Temperature.csv", show_col_types = FALSE)
co2 <- co2 %>%
filter(Name == "United States" & year >= 1900 & year <= 2022)
df <- co2 %>%
left_join(temp, by = c("year" = "Year"))
head(df)
summary(df)
df %>%
select(year, population, gdp, co2, nitrous_oxide, methane, Average_Fahrenheit_Temperature) %>%
summarise(across(everything(), ~sum(is.na(.))))
# Time series plot of temperature
temp_ts <- ts(df$Average_Fahrenheit_Temperature, start = 1900, frequency = 1)
tsplot(temp_ts, ylab = "Average Temperature (F)", main = "Average Annual US Temperature 1900-2022")
# Trend and stationarity
adf.test(df$Average_Fahrenheit_Temperature)
# Emissions time series
methane_ts <- ts(df$methane, start = min(df$year), frequency = 1)
n2o_ts <- ts(df$nitrous_oxide, start = min(df$year), frequency = 1)
ts.plot(methane_ts, n2o_ts, col=c("blue","red"), lty=1:2,
ylab="Emissions (Tonnes)", xlab="Year",
main="US Methane vs Nitrous Oxide Emissions")
legend("topleft", legend=c("Methane","Nitrous Oxide"), col=c("blue","red"), lty=1:2, bty="n")
# Growth rates
dlog_methane <- diff(log(methane_ts))
dlog_n2o <- diff(log(n2o_ts))
ts.plot(dlog_methane, dlog_n2o, col=c("blue","red"),
ylab="Log Growth Rate", xlab="Year",
main="Methane and N2O Growth Rates")
legend("topright", legend=c("Methane","N2O"), col=c("blue","red"), lty=1)
# Cross-correlation and lag plots
ccf(dlog_methane, dlog_n2o, main="CCF: Methane vs N2O Growth")
lag2.plot(dlog_methane,dlog_no, 5)
# Rolling variance plot (window = 100 years)
roll_var <- rollapply(df$Average_Fahrenheit_Temperature, width=10, FUN=var, by=1, align="right")
plot(roll_var, type="l", col="darkgreen",
ylab="Rolling Variance (100-year window)", xlab="Year (end of window)",
main="Rolling 100-Year Variance of US Temperature")
mid <- floor(nrow(df)/2)
var_first_half <- var(df$Average_Fahrenheit_Temperature[1:mid])
var_second_half <- var(df$Average_Fahrenheit_Temperature[(mid+1):nrow(df)])
var_first_half
var_second_half
# Levene's Test
df$period <- ifelse(df$year <= median(df$year), "Early", "Late")
leveneTest(Average_Fahrenheit_Temperature ~ period, data=df)
# Rolling variance plot (window = 100 years)
roll_var <- rollapply(df$Average_Fahrenheit_Temperature, width=10, FUN=var, by=1, align="right")
plot(roll_var, type="l", col="darkgreen",
ylab="Rolling Variance (100-year window)", xlab="Year (end of window)",
main="")
mid <- floor(nrow(df)/2)
var_first_half <- var(df$Average_Fahrenheit_Temperature[1:mid])
var_second_half <- var(df$Average_Fahrenheit_Temperature[(mid+1):nrow(df)])
var_first_half
var_second_half
# Levene's Test
df$period <- ifelse(df$year <= median(df$year), "Early", "Late")
leveneTest(Average_Fahrenheit_Temperature ~ period, data=df)
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(fig.align='center')
knitr::opts_chunk$set(fig.width=5)
knitr::opts_chunk$set(fig.height=3)
# Rolling variance plot (window = 100 years)
roll_var <- rollapply(df$Average_Fahrenheit_Temperature, width=10, FUN=var, by=1, align="right")
plot(roll_var, type="l", col="darkgreen",
ylab="Rolling Variance (100-year window)", xlab="Year (end of window)",
main="")
mid <- floor(nrow(df)/2)
var_first_half <- var(df$Average_Fahrenheit_Temperature[1:mid])
var_second_half <- var(df$Average_Fahrenheit_Temperature[(mid+1):nrow(df)])
var_first_half
var_second_half
# Levene's Test
df$period <- ifelse(df$year <= median(df$year), "Early", "Late")
leveneTest(Average_Fahrenheit_Temperature ~ period, data=df)
# Rolling variance plot (window = 100 years)
roll_var <- rollapply(df$Average_Fahrenheit_Temperature, width=10, FUN=var, by=1, align="right")
plot(roll_var, type="l", col="darkgreen",
ylab="Rolling Variance (100-year window)", xlab="Year (end of window)",
main="")
mid <- floor(nrow(df)/2)
var_first_half <- var(df$Average_Fahrenheit_Temperature[1:mid])
var_second_half <- var(df$Average_Fahrenheit_Temperature[(mid+1):nrow(df)])
var_first_half
var_second_half
# Levene's Test
df$period <- ifelse(df$year <= median(df$year), "Early", "Late")
leveneTest(Average_Fahrenheit_Temperature ~ period, data=df)
# Rolling variance plot (window = 100 years)
roll_var <- rollapply(df$Average_Fahrenheit_Temperature, width=10, FUN=var, by=1, align="right")
# Rolling variance plot (window = 100 years)
roll_var <- rollapply(df$Average_Fahrenheit_Temperature, width=10, FUN=var, by=1, align="right")
mid <- floor(nrow(df)/2)
var_first_half <- var(df$Average_Fahrenheit_Temperature[1:mid])
var_second_half <- var(df$Average_Fahrenheit_Temperature[(mid+1):nrow(df)])
var_first_half
var_second_half
# Levene's Test
df$period <- ifelse(df$year <= median(df$year), "Early", "Late")
leveneTest(Average_Fahrenheit_Temperature ~ period, data=df)
# Rolling variance plot (window = 100 years)
roll_var <- rollapply(df$Average_Fahrenheit_Temperature, width=10, FUN=var, by=1, align="right")
plot(roll_var, type="l", col="darkgreen",
ylab="Rolling Variance (100-year window)", xlab="Year (end of window)",
main="")
co2 <- read_csv("data/Data.csv", show_col_types = FALSE)
temp <- read_csv("data/Temperature.csv", show_col_types = FALSE)
co2 <- co2 %>%
filter(Name == "United States" & year >= 1900 & year <= 2022)
df <- co2 %>%
left_join(temp, by = c("year" = "Year"))
df
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(fig.align='center')
knitr::opts_chunk$set(fig.width=5)
knitr::opts_chunk$set(fig.height=3)
library(dplyr)
library(tidyverse)
library(astsa)
library(TSA)
library(fpp2)
library(nlme)
library(forecast)
library(tseries)
library(zoo)
library(car)
co2 <- read_csv("data/Data.csv", show_col_types = FALSE)
temp <- read_csv("data/Temperature.csv", show_col_types = FALSE)
co2 <- co2 %>%
filter(Name == "United States" & year >= 1900 & year <= 2022)
df <- co2 %>%
left_join(temp, by = c("year" = "Year"))
temp_ts <- ts(df$Average_Fahrenheit_Temperature, start = 1900, frequency = 1)
tsplot(temp_ts, ylab = "Average Temperature (F)", main = "Average Annual US Temperature 1900-2022")
# Rolling variance plot (window = 100 years)
roll_var <- rollapply(df$Average_Fahrenheit_Temperature, width=10, FUN=var, by=1, align="right")
plot(roll_var, type="l", col="darkgreen",
ylab="Rolling Variance (100-year window)", xlab="Year (end of window)",
main="")
library(tidyverse)
library(astsa)
library(TSA)
library(fpp2)
library(tseries)
data <-read_delim("SN_y_tot_V2.0.csv",
delim = ";", escape_double = FALSE, col_names = FALSE,
trim_ws = TRUE, show_col_types = FALSE)
names(data) = c("Year", "Mean Sunspots", "Mean SD", "Observations", "Marker")
data_ts <- data|>
select(c(2))
data_ts <- ts(data_ts, start = 1700.5)
tsplot(data_ts, ylab = "Mean Number of Sunspots")
adf.test(data_ts, )
x <- data_ts - mean(data_ts)
s_un <- spec.pgram(x, log = "no", main = "")
s_sm <- spec.pgram(x, spans = c(5,5), log = "no",
main="")
spec <- spec.pgram(x, plot=FALSE)
freq_max <- spec$freq[which.max(spec$spec)]
period_est <- 1 / freq_max
ar_fit <- ar(x, method = "yw")
s_ar <- spec.ar(x, main="")
x <- as.numeric(data_ts)
t <- 1:length(x)
f0 <- 1/period_est
z <- x * exp(-1i * 2*pi*f0*t)
library(signal)
library(pracma)
bf <- butter(4, 0.02)
z_lp <- filtfilt(bf, z)
phi <- Arg(z_lp)
phi_unwrapped <- unwrap(phi)
phi_smooth <- filtfilt(butter(3, 0.01), phi_unwrapped)
dphi <- c(NA, diff(phi_smooth))
inst_freq <- dphi / (2*pi)
inst_freq[abs(inst_freq) < 0.0005] <- NA
inst_period <- 1 / inst_freq
plot(inst_period, type="l",
main="",
ylab="Years")
abline(h=11, col="red")
x <- as.numeric(data_ts)
t <- 1:length(x)
f0 <- 1/22
z <- x * exp(-1i * 2*pi*f0*t)
bf <- butter(4, 0.05)
z_lp <- filtfilt(bf, z)
amp <- Mod(z_lp)
phi <- Arg(z_lp)
phi_unwrapped <- unwrap(phi)
bf2 <- butter(3, 0.01)
phi_smooth <- filtfilt(bf2, phi_unwrapped)
dphi <- c(NA, diff(phi_smooth))
inst_freq <- dphi / (2*pi)
inst_freq[abs(inst_freq) < 1e-5] <- NA
inst_period <- 1 / inst_freq
plot(inst_period, type="l",
main="",
ylab="Years")
abline(h=22, col="red")
library(WaveletComp)
df <- data.frame(time = time(data_ts), value = as.numeric(data_ts))
temp <- capture.output(
result <- analyze.wavelet(
df,
"value",
loess.span = 0,
dt = 1,
dj = 1/20,
lowerPeriod = 2,
upperPeriod = 256,
make.pval = FALSE
)
)
wt.image(result,
color.key = "quantile",
legend.params = list(lab = "Power"),
main = "")
power <- result$Power
periods <- result$Period
dominant_periods <- apply(power, 2, function(col) {
periods[which.max(col)]
})
mean_dominant_period <- mean(dominant_periods, na.rm = TRUE)
library(multitaper)
win <- 96
step <- 1
periods <- c()
years <- c()
for (i in seq(1, length(x)-win, by=step)) {
seg <- x[i:(i+win)]
mt <- spec.mtm(seg, k=5, nw=3, plot=FALSE)
fpeak <- mt$freq[which.max(mt$spec)]
periods <- c(periods, 1/fpeak)
years <- c(years, i)
}
plot(years, periods, type="l", col="blue",
ylab="Cycle Length (Years)",
main="")
abline(h=mean(periods), col="red", lty=2)
usr <- par("usr")
x_right <- usr[2] - 1*(usr[2] - usr[1])   # shift 5% inside the plot
# Add the label
text(x = x_right, y = mean(periods)*1.05,
labels = paste0("Mean = ", round(mean(periods), 2), " years"),
col="red", pos=4)
# Rolling variance plot (window = 100 years)
roll_var <- rollapply(df$Average_Fahrenheit_Temperature, width=10, FUN=var, by=1, align="right")
mid <- floor(nrow(df)/2)
var_first_half <- var(df$Average_Fahrenheit_Temperature[1:mid])
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(fig.align='center')
knitr::opts_chunk$set(fig.width=5)
knitr::opts_chunk$set(fig.height=3)
library(dplyr)
library(tidyverse)
library(astsa)
library(TSA)
library(fpp2)
library(nlme)
library(forecast)
library(tseries)
library(zoo)
library(car)
co2 <- read_csv("data/Data.csv", show_col_types = FALSE)
temp <- read_csv("data/Temperature.csv", show_col_types = FALSE)
co2 <- co2 %>%
filter(Name == "United States" & year >= 1900 & year <= 2022)
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(fig.align='center')
knitr::opts_chunk$set(fig.width=5)
knitr::opts_chunk$set(fig.height=3)
library(dplyr)
library(tidyverse)
library(astsa)
library(TSA)
library(fpp2)
library(nlme)
library(forecast)
library(tseries)
library(zoo)
library(car)
co2 <- read_csv("data/Data.csv", show_col_types = FALSE)
temp <- read_csv("data/Temperature.csv", show_col_types = FALSE)
co2 <- co2 %>%
filter(Name == "United States" & year >= 1900 & year <= 2022)
